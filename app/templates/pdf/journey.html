<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
</head>
<body>
    <!-- Watermark -->
    <div class="watermark">{{ user.email }}</div>

    <!-- Cover Page -->
    <div class="cover-page">
        <h1 class="cover-title">Your Self-Reflective Journey</h1>
        <h2 class="cover-subtitle">{{ user.user_name if user.user_name else user.email.split('@')[0] }}</h2>
        <p class="cover-date">Generated on {{ generation_date }}</p>
    </div>

    <!-- Statistics Section -->
    <div class="section">
        <h2 class="section-title">Your Progress</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-title">Total Points</div>
                <div class="stat-value">{{ stats.total_points }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Current Streak</div>
                <div class="stat-value">{{ stats.current_streak }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Longest Streak</div>
                <div class="stat-value">{{ stats.longest_streak }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Total Entries</div>
                <div class="stat-value">{{ stats.total_entries }}</div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="section">
        <h2 class="section-title">Progress Visualization</h2>
        <div class="chart-container">
            <img src="data:image/png;base64,{{ points_chart }}" alt="Points Over Time" class="chart-image">
        </div>
        {% if wordcloud_chart %}
        <div class="chart-container">
            <h3 class="section-title" style="margin-top: 2rem;">Words Discovered</h3>
            <img src="data:image/png;base64,{{ wordcloud_chart }}" alt="Word Cloud" class="chart-image">
        </div>
        {% endif %}
        <div class="chart-container">
            <img src="data:image/png;base64,{{ weekday_chart }}" alt="Average Points by Day" class="chart-image">
        </div>
    </div>

    <!-- Goals Section -->
    {% if goal_stats %}
    <div class="section">
        <h2 class="section-title">Goal Achievement</h2>
        
        <!-- Goal Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-title">Goals Completed</div>
                <div class="stat-value">{{ goal_stats.total_completed }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Success Rate</div>
                <div class="stat-value">{{ goal_stats.success_rate }}%</div>
            </div>
        </div>

        <!-- Goal Category Chart -->
        {% if goal_chart %}
        <div class="chart-container">
            <h3 class="section-title" style="margin-top: 2rem;">Goal Performance by Category</h3>
            <img src="data:image/png;base64,{{ goal_chart }}" alt="Goal Performance by Category" class="chart-image">
        </div>
        {% endif %}

        <!-- Goal History -->
        {% if goal_history %}
        <div class="section">
            <h3 class="section-title" style="margin-top: 2rem;">Goal History</h3>
            <p class="text-muted">Total goals: {{ goal_history|length }}</p>
            
            {% for goal in goal_history %}
            <div class="goal-entry{% if goal.status.value == 'failed' %} failed{% endif %}">
                <div class="entry-date">{{ goal.created_at.strftime('%A, %B %d, %Y') }}</div>
                <div class="goal-title">{{ goal.title }}</div>
                {% if goal.description %}
                <div class="goal-description">{{ goal.description }}</div>
                {% endif %}
                <div class="goal-category">{{ goal.category.value }}</div>
                {% if goal.status.value == 'completed' %}
                    <div class="goal-status completed">✓ Completed</div>
                {% else %}
                    <div class="goal-status failed">✗ Failed</div>
                {% endif %}
            </div>
            {% if not loop.last %}<hr class="entry-separator">{% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- All Entries Section -->
    <div class="section">
        <h2 class="section-title">Your Journey</h2>
        <p class="text-muted">Total entries: {{ entries|length }}</p>
        
        {% if entries %}
            {% for entry in entries %}
            <div class="diary-entry">
                <div class="entry-date">{{ entry.entry_date.strftime('%A, %B %d, %Y') }}</div>
                <div class="entry-content">
                    <!-- Debug info -->
                    <small class="debug-info" style="color: #999; font-size: 8pt;">
                        Entry ID: {{ entry.id }} | Date: {{ entry.entry_date }}
                    </small>
                    <div class="content-text">{{ entry.content }}</div>
                </div>
                {% if entry.rating == 1 %}
                    <div class="entry-rating encouraged">Encouraged behavior (+5 points)</div>
                {% else %}
                    <div class="entry-rating change">Want to change (+2 points)</div>
                {% endif %}
            </div>
            {% if not loop.last %}<hr class="entry-separator">{% endif %}
            {% endfor %}
        {% else %}
            <p class="no-entries">No entries found in template. Debug info:</p>
            <pre style="font-size: 8pt; color: #666;">
                Entries variable type: {{ entries.__class__.__name__ }}
                Is entries empty: {{ entries|length == 0 }}
            </pre>
        {% endif %}
    </div>
</body>
</html> 