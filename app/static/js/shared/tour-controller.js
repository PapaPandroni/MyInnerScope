class OnboardingTour{constructor(){this.isActive=false;this.currentPage=0;this.currentTour=null;this.isNewUserTour=false;this.tours=this.initializeTours();this.start=this.start.bind(this);this.skip=this.skip.bind(this);this.nextPage=this.nextPage.bind(this);this.prevPage=this.prevPage.bind(this);this.complete=this.complete.bind(this);this.startJourney=this.startJourney.bind(this);this.done=this.done.bind(this);}initializeTours(){return{diary:{pages:[{title:"Welcome to Your Inner Universe",content:"In just a few minutes,you'll create your first reflection and discover how it becomes insight.",icon:"fas fa-star"},{title:"Daily Reflection Space",content:"The core function of this page is to write daily diary entries about situations and your actions throughout the day. You can write as many entries as you like.",icon:"fas fa-book"},{title:"Self-Awareness Through Reflection",content:"Reflect on your actions and behaviors. Are your actions today something you want to continue encouraging,or something you want to improve and change? Identifying your own behaviors is the first step to self-improvement.",icon:"fas fa-mirror"},{title:"Begin Your Journey",content:"Start by writing your first diary entry and identify and categorize your behavior. Every great journey of self-discovery begins with a single step.",icon:"fas fa-rocket",isLast:true}]},progress:{pages:[{title:"Your Progress Dashboard",content:"Welcome to your Progress Dashboard!This is where your daily reflections transform into meaningful insights about your personal growth journey.",icon:"fas fa-chart-line"},{title:"Track Your Growth",content:"Track your progress over time through interactive charts and statistics. See patterns in your behavior and celebrate your consistency with streak tracking.",icon:"fas fa-trophy"},{title:"Behavior Insights",content:"Your behavior cards show the balance between actions you want to encourage and those you want to improve. Watch your growth unfold as you continue your reflection practice.",icon:"fas fa-balance-scale",isDone:true}]},read_diary:{pages:[{title:"Your Reflection Archive",content:"Welcome to your Reflection Archive!Here you can revisit and search through all your diary entries to discover patterns and insights.",icon:"fas fa-archive"},{title:"Search and Discover",content:"Use the search feature to find specific moments,emotions,or situations. Filter by date or behavior type to focus on particular aspects of your growth.",icon:"fas fa-search"},{title:"Recognize Your Progress",content:"Reading your past entries helps you recognize progress you might not have noticed. Your journey of self-awareness becomes clearer over time.",icon:"fas fa-lightbulb",isDone:true}]},goals:{pages:[{title:"Your Goal Setting Hub",content:"Welcome to your Goal Setting Hub!Set meaningful weekly objectives that align with your personal growth journey.",icon:"fas fa-target"},{title:"Create Meaningful Goals",content:"Create specific,actionable goals that connect to the behaviors you're working on. Focus on what you want to improve or encourage in yourself.",icon:"fas fa-bullseye"},{title:"Track Your Progress",content:"Track your progress toward each goal and see how your daily diary entries contribute to achieving your objectives.",icon:"fas fa-chart-bar"},{title:"Set Your First Goal",content:"Start by setting your first goal that supports your self-improvement journey. Small,consistent steps lead to remarkable transformation.",icon:"fas fa-flag",isDone:true}]}};}shouldShowTour(){const completed=localStorage.getItem('tour_completed');const is_new_user=window.tour_config?.is_new_user||false;const user_entry_count=window.tour_config?.user_entry_count||0;return!completed&&is_new_user&&user_entry_count===0;}shouldAutoStartTour(){const pageName=this.getCurrentPageName();const hasVisited=localStorage.getItem(`tour_visited_${pageName}`);return!hasVisited;}markPageVisited(){const pageName=this.getCurrentPageName();localStorage.setItem(`tour_visited_${pageName}`,'true');}getCurrentPageName(){const path=window.location.pathname;if(path.includes('/progress'))return 'progress';if(path.includes('/read'))return 'read_diary';if(path.includes('/goals'))return 'goals';return 'diary';}init(){if(this.shouldShowTour()){this.isNewUserTour=true;setTimeout(()=>{this.start();},500);}else if(this.shouldAutoStartTour()){this.isNewUserTour=false;setTimeout(()=>{this.start();},1000);}this.addTourMenuOption();}start(pageName=null){const currentPageName=pageName||this.getCurrentPageName();if(!this.tours[currentPageName]){return;}this.isActive=true;this.currentPage=0;this.currentTour=this.tours[currentPageName];sessionStorage.setItem('tour_active','true');sessionStorage.setItem('tour_page',currentPageName);sessionStorage.setItem('tour_current_page','0');if(pageName!==null){this.isNewUserTour=false;}this.showTourModal();}showTourModal(){if(!this.currentTour||!this.currentTour.pages[this.currentPage]){return;}const page=this.currentTour.pages[this.currentPage];const totalPages=this.currentTour.pages.length;const modalHTML=`<div class="modal fade tour-modal" id="tourModal" tabindex="-1" role="dialog" aria-labelledby="tourModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content tour-modal-content"><div class="modal-body text-center"><div class="tour-cosmic-header"><i class="${page.icon}tour-icon"></i><h2 class="tour-title">${page.title}</h2><p class="tour-content">${page.content}</p></div><div class="tour-page-indicator"><span class="tour-page-numbers">${this.currentPage+1}/${totalPages}</span></div><div class="tour-navigation">${this.currentPage>0 ?
'<button class="btn btn-outline-secondary tour-btn-prev" id="tour_prev_btn">Previous</button>':''}<button class="btn btn-outline-light tour-btn-skip" id="tour_skip_btn">Skip</button>${page.isDone ?
'<button class="btn btn-primary tour-btn-primary" id="tour_done_btn"><i class="fas fa-check me-2"></i>Done</button>':page.isLast ?
'<button class="btn btn-primary tour-btn-primary" id="tour_journey_btn"><i class="fas fa-rocket me-2"></i>Start Journey</button>':'<button class="btn btn-primary tour-btn-primary" id="tour_next_btn">Next</button>'}</div></div></div></div></div>`;const existingModal=document.getElementById('tourModal');if(existingModal){existingModal.remove();}document.body.insertAdjacentHTML('beforeend',modalHTML);this.addModalEventListeners();const modal=new bootstrap.Modal(document.getElementById('tourModal'));modal.show();}addModalEventListeners(){const prevBtn=document.getElementById('tour_prev_btn');const nextBtn=document.getElementById('tour_next_btn');const skipBtn=document.getElementById('tour_skip_btn');const journeyBtn=document.getElementById('tour_journey_btn');const doneBtn=document.getElementById('tour_done_btn');if(prevBtn){prevBtn.addEventListener('click',this.prevPage);}if(nextBtn){nextBtn.addEventListener('click',this.nextPage);}if(skipBtn){skipBtn.addEventListener('click',this.skip);}if(journeyBtn){journeyBtn.addEventListener('click',this.startJourney);}if(doneBtn){doneBtn.addEventListener('click',this.done);}}nextPage(){if(this.currentPage<this.currentTour.pages.length-1){this.currentPage++;sessionStorage.setItem('tour_current_page',this.currentPage.toString());this.hideModal(()=>{this.showTourModal();});}}prevPage(){if(this.currentPage>0){this.currentPage--;sessionStorage.setItem('tour_current_page',this.currentPage.toString());this.hideModal(()=>{this.showTourModal();});}}skip(){this.hideModal(()=>{if(this.isNewUserTour){this.completeGlobalTour();}else{this.completePageTour();}});}done(){this.hideModal(()=>{if(this.isNewUserTour){this.completeGlobalTour();}else{this.completePageTour();}});}startJourney(){this.hideModal(()=>{if(this.isNewUserTour){this.completeGlobalTour();}else{this.completePageTour();}const currentPageName=this.getCurrentPageName();if(currentPageName==='diary'){const textarea=document.getElementById('diary_textarea');if(textarea){textarea.focus();}}else if(currentPageName==='goals'){const goalInput=document.querySelector('input[name="goal_title"],#goal-title');if(goalInput){goalInput.focus();}}});}hideModal(callback){const modal=document.getElementById('tourModal');if(modal){const bsModal=bootstrap.Modal.getInstance(modal);if(bsModal){bsModal.hide();}setTimeout(()=>{modal.remove();if(callback)callback();},300);}else if(callback){callback();}}complete(){this.isActive=false;localStorage.setItem('tour_completed','true');sessionStorage.removeItem('tour_active');sessionStorage.removeItem('tour_page');sessionStorage.removeItem('tour_current_page');this.cleanup();}completePageTour(){this.isActive=false;this.markPageVisited();sessionStorage.removeItem('tour_active');sessionStorage.removeItem('tour_page');sessionStorage.removeItem('tour_current_page');this.cleanup();this.addTourMenuOption();}completeGlobalTour(){this.markPageVisited();this.complete();this.addTourMenuOption();}cleanup(){document.querySelectorAll('.tour-modal').forEach(el=>{el.remove();});document.querySelectorAll('.modal-backdrop').forEach(backdrop=>{backdrop.remove();});}addTourMenuOption(){const dropdown=document.querySelector('.dropdown-menu');if(dropdown){const existingTourItem=dropdown.querySelector('#retake-tour');if(existingTourItem){return;}const hasSeenAnyTour=localStorage.getItem('tour_completed')||localStorage.getItem(`tour_visited_${this.getCurrentPageName()}`);if(hasSeenAnyTour){const tourItem=document.createElement('li');tourItem.innerHTML='<a class="dropdown-item" href="#" id="retake-tour">Take Tour Again</a>';const logoutItem=dropdown.querySelector('a[href="/logout"]')?.parentElement;if(logoutItem){dropdown.insertBefore(tourItem,logoutItem);}else{dropdown.appendChild(tourItem);}document.getElementById('retake-tour').addEventListener('click',(e)=>{e.preventDefault();this.isNewUserTour=false;this.start();});}}}resumeIfActive(){const tourActive=sessionStorage.getItem('tour_active');const tourPage=sessionStorage.getItem('tour_page');const currentPageNum=parseInt(sessionStorage.getItem('tour_current_page')||'0');if(tourActive==='true'&&tourPage){const currentPageName=this.getCurrentPageName();if(currentPageName===tourPage){this.isActive=true;this.currentPage=currentPageNum;this.currentTour=this.tours[tourPage];this.isNewUserTour=this.shouldShowTour();setTimeout(()=>{this.showTourModal();},500);}}}}document.addEventListener('DOMContentLoaded',function(){window.onboardingTour=new OnboardingTour();if(sessionStorage.getItem('tour_active')==='true'){window.onboardingTour.resumeIfActive();}else{window.onboardingTour.init();}});window.addEventListener('beforeunload',function(){if(window.onboardingTour&&window.onboardingTour.isActive){}});