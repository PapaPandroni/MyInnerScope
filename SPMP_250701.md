# Single Point of Management Plan (SPMP) - 2025-07-01

This document consolidates all identified unfinished features and implementations from various project documentation files. It serves as a centralized reference for the ongoing development roadmap.

---

## 1. Foundational Tooling & Infrastructure

### 1.1. Database Migrations
- **Status**: Initial setup (`Flask-Migrate`) is complete, but the process of *using* it for schema changes needs to be consistently applied.
- **Action**: Ensure all future database schema modifications are managed via `flask db migrate` and `flask db upgrade`.

### 1.2. Testing Framework
- **Status**: `pytest` is set up.
- **Action**: Continuously write comprehensive unit, integration, and functional tests for new and existing features to ensure code stability and prevent regressions.

---

## 2. Security Hardening & Compliance

### 2.1. Security Hardening
- **CSRF Protection for AJAX Requests**:
    - **Status**: Identified as a gap.
    - **Action**: Implement CSRF protection for all JavaScript-driven POST requests (e.g., PDF export, API calls).
- **Rate Limiting**:
    - **Status**: Completed.
    - **Action**: Applied comprehensive rate limits to all sensitive blueprints (`auth`, `diary`, `goals`, `user`, `progress`, `reader`) in `routes/__init__.py`. Added a new test file `tests/test_security.py` to verify the implementation.
- **Dependency Security Audit**:
    - **Status**: Automated checks (`safety`, `pip-audit`) are configured in GitHub Actions.
    - **Action**: Regularly review audit reports and address identified vulnerabilities in dependencies.

### 2.2. Legal & Compliance (GDPR Focus)
- **Privacy Policy and Cookie Consent**:
    - **Status**: Basic pages and cookie consent banner are implemented.
    - **Action**: Review and complete the content of the Privacy Policy and Terms of Service to ensure full GDPR compliance. Refine the cookie consent mechanism if necessary.
- **User Data Deletion (Right to Erasure)**:
    - **Status**: Account deletion route exists.
    - **Action**: Thoroughly test and ensure the "Delete Account" feature securely and completely removes all associated user data (cascading delete).
- **Data Portability**:
    - **Status**: Data download routes (JSON, CSV) are implemented.
    - **Action**: Verify the completeness and accuracy of exported data for all user-related information.

---

## 3. Feature Enhancements & New Functionality

### 3.1. Dashboard Enhancements
- **Status**: Identified as future improvements.
- **Action**: Implement:
    - Weekly/monthly comparison views.
    - Missed days analysis (90-day lookback).
    - Enhanced chart styling and interactions beyond current capabilities.

### 3.2. User Experience Improvements
- **Status**: Identified as future improvements.
- **Action**: Implement:
    - Email verification and password reset functionality.
    - Profile customization options.
    - Dark/light mode toggle.
    - Onboarding tour for new users.

### 3.3. New Functionality
- **Search Functionality for Diary Entries**:
    - **Status**: Partially implemented in `reader.py`.
    - **Action**: Enhance search capabilities (e.g., more advanced filtering, full-text search indexing if needed).
- **Weekly Reflection Prompts**:
    - **Status**: Identified as a new feature.
    - **Action**: Develop a system for providing weekly reflection prompts to users.
- **Advanced Analytics and Insights**:
    - **Status**: Identified as a new feature.
    - **Action**: Explore and implement more sophisticated data analysis and personalized insights for users.

---

## 4. Code Quality & Refactoring

### 4.1. Project Structure and File Naming
- **Status**: Partial adherence to `flask_style_guide.md`.
- **Action**:
    - Create an `app` directory and move core application files (`config.py`, `models/`, `routes/`, `static/`, `templates/`, `utils/`) into it. Rename `app.py` to `run.py` in the root.
    - Complete renaming of all files and directories to `snake_case` (e.g., `custom_css.css` to `main.css`, `read_diary.html` to `reader.html`).
    - Update `GEMINI.md` to reflect the final project structure and file names.

### 4.2. Python Code Style
- **Status**: Partial adherence to `flask_style_guide.md`.
- **Action**:
    - Apply `black` code formatter to the entire project.
    - Refactor all `camelCase` variables and functions to `snake_case`.
    - Add comprehensive type hints to all function definitions.
    - Convert all existing docstrings to Google-style format.

### 4.3. Route and Helper Organization
- **Status**: Blueprints exist, but not fully organized into feature-based packages.
- **Action**:
    - Create feature-based route packages (e.g., `app/routes/auth/`, `app/routes/diary/`) with `__init__.py`, `routes.py`, and `helpers.py` files.
    - Move route logic and helper functions into their respective feature packages.
    - Update all imports throughout the application to reflect the new locations.

### 4.4. Static and Template File Organization
- **Status**: Partially organized.
- **Action**:
    - Organize CSS and JavaScript files more granularly by feature within `static/css/` and `static/js/`.
    - Organize HTML templates into feature-based subdirectories within `templates/`.
    - Update all `url_for()` and `render_template()` calls to point to the new file locations.

### 4.5. HTML and JavaScript Style
- **Status**: Partial adherence to `flask_style_guide.md`.
- **Action**:
    - Update all HTML `id` and custom `data-*` attributes from `kebab-case` or `camelCase` to `snake_case`.
    - Refactor all JavaScript variable and function names from `camelCase` to `snake_case`.

### 4.6. Database Refactoring
- **Status**: Identified as a future task.
- **Action**:
    - Update SQLAlchemy model definitions to use `snake_case` and plural for table names (e.g., `users`, `diary_entries`) and `snake_case` for column names.
    - Create and apply a database migration script to rename tables and columns in the `users.db` SQLite database without data loss.
    - Update all SQLAlchemy queries in the application to use the new table and column names.

### 4.7. Final Review and Cleanup
- **Status**: Pending completion of all above refactoring tasks.
- **Action**:
    - Run all tests to ensure no functionality is broken.
    - Conduct a final review of the entire codebase for consistency with the style guide.
    - Remove any empty or unused files and directories.
    - Update `README.md` to reflect the new project structure and setup instructions.

---

## 5. Technical Debt & Performance

### 5.1. Database Performance
- **Status**: Identified as a future improvement.
- **Action**: Add explicit database indexes to frequently queried columns (e.g., foreign keys, date columns) to improve read query performance.

### 5.2. Centralize Flash Message Handling
- **Status**: Identified as a maintainability improvement.
- **Action**: Consider centralizing the logic for `flash` messages into a helper function or dedicated utility for consistency and easier management.

### 5.3. Review Datetime Usage for Consistency
- **Status**: Identified as a consistency improvement.
- **Action**: Review all instances of `datetime.now().date()` and `date.today()` to ensure consistent and appropriate use, especially concerning timezone awareness for date-only comparisons.
